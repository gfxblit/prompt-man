(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();var r=(o=>(o.Empty="Empty",o.Wall="Wall",o.Pellet="Pellet",o.PowerPellet="PowerPellet",o.PacmanSpawn="PacmanSpawn",o.GhostSpawn="GhostSpawn",o))(r||{}),u=(o=>(o.Pacman="Pacman",o.Ghost="Ghost",o))(u||{});const p={"#":r.Wall,".":r.Pellet,o:r.PowerPellet," ":r.Empty,P:r.PacmanSpawn,G:r.GhostSpawn};class m{tiles;width;height;tileCache=new Map;constructor(t,e,i=r.Empty){this.width=t,this.height=e,this.tiles=Array.from({length:e},()=>Array.from({length:t},()=>i)),t>0&&e>0&&this.rebuildCache()}static fromString(t){const e=t.trim();if(!e)return new m(0,0);const i=e.split(`
`),s=i.length,n=i.length>0?Math.max(...i.map(a=>a.length)):0,l=new m(n,s,r.Empty);for(let a=0;a<s;a++){const h=i[a];if(h)for(let d=0;d<n;d++){const P=h[d];if(P===void 0)continue;const w=p[P]||r.Empty;w!==r.Empty&&l.setTile(d,a,w)}}return l}rebuildCache(){this.tileCache.clear();for(let t=0;t<this.height;t++){const e=this.tiles[t];if(e)for(let i=0;i<this.width;i++){const s=e[i];s!==void 0&&(this.tileCache.has(s)||this.tileCache.set(s,[]),this.tileCache.get(s).push({x:i,y:t}))}}}getWidth(){return this.width}getHeight(){return this.height}getTile(t,e){if(!this.isOutOfBounds(t,e))return this.tiles[e]?.[t]}setTile(t,e,i){if(this.isOutOfBounds(t,e))return;const s=this.tiles[e];if(s){const n=s[t];if(n===i)return;if(s[t]=i,n!==void 0){const l=this.tileCache.get(n);if(l){const a=l.findIndex(h=>h.x===t&&h.y===e);a!==-1&&l.splice(a,1)}}this.tileCache.has(i)||this.tileCache.set(i,[]),this.tileCache.get(i).push({x:t,y:e})}}isOutOfBounds(t,e){return t<0||t>=this.width||e<0||e>=this.height}isWalkable(t,e){const i=this.getTile(t,e);return i!==void 0&&i!==r.Wall}findTiles(t){return[...this.tileCache.get(t)||[]]}}const y=10,E=50,c=8,g={WALL:"blue",PELLET:"peachpuff",PACMAN:"yellow",GHOST_DEFAULT:"red"},x=`
############################
#............##............#
#.####.#####.##.#####.####.#
#o####.#####.##.#####.####o#
#.####.#####.##.#####.####.#
#..........................#
#.####.##.########.##.####.#
#.####.##.########.##.####.#
#......##....##....##......#
######.##### ## #####.######
     #.##### ## #####.#     
     #.##    G     ##.#     
     #.## ######## ##.#     
######.## #      # ##.######
      .   #      #   .      
######.## #      # ##.######
     #.## ######## ##.#     
     #.##    P     ##.#     
     #.## ######## ##.#     
######.## ######## ##.######
#............##............#
#.####.#####.##.#####.####.#
#.####.#####.##.#####.####.#
#o..##................##..o#
###.##.##.########.##.##.###
###.##.##.########.##.##.###
#......##....##....##......#
#.##########.##.##########.#
#.##########.##.##########.#
#..........................#
############################
`.trim();class L{constructor(t){this.ctx=t}render(t,e){const i=t.getWidth(),s=t.getHeight();this.ctx.clearRect(0,0,i*c,s*c);for(let n=0;n<s;n++)for(let l=0;l<i;l++){const a=t.getTile(l,n);a&&((a===r.Pellet||a===r.PowerPellet)&&e.isPelletEaten(l,n)||this.renderTile(l,n,a))}this.renderEntities(e.getEntities())}renderTile(t,e,i){const s=t*c,n=e*c;switch(i){case r.Wall:this.ctx.fillStyle=g.WALL,this.ctx.fillRect(s,n,c,c);break;case r.Pellet:this.ctx.fillStyle=g.PELLET,this.ctx.fillRect(s+c/2-1,n+c/2-1,2,2);break;case r.PowerPellet:this.ctx.fillStyle=g.PELLET,this.ctx.beginPath(),this.ctx.arc(s+c/2,n+c/2,3,0,Math.PI*2),this.ctx.fill();break;case r.Empty:case r.PacmanSpawn:case r.GhostSpawn:}}renderEntities(t){for(const e of t)this.renderEntity(e)}renderEntity(t){const e=t.x*c+c/2,i=t.y*c+c/2;switch(t.type){case u.Pacman:this.ctx.fillStyle=g.PACMAN,this.ctx.beginPath(),this.ctx.arc(e,i,c/2-1,.2*Math.PI,1.8*Math.PI),this.ctx.lineTo(e,i),this.ctx.closePath(),this.ctx.fill();break;case u.Ghost:this.ctx.fillStyle=t.color||g.GHOST_DEFAULT,this.ctx.beginPath(),this.ctx.arc(e,i,c/2-1,Math.PI,0),this.ctx.lineTo(e+c/2-1,i+c/2-1),this.ctx.lineTo(e-c/2+1,i+c/2-1),this.ctx.closePath(),this.ctx.fill();break}}}class S{constructor(t){this.grid=t,this.initialize()}entities=[];score=0;remainingPellets=0;eatenPellets=new Set;initialize(){const t=this.grid.findTiles(r.PacmanSpawn);for(const n of t)this.entities.push({type:u.Pacman,x:n.x,y:n.y});const e=this.grid.findTiles(r.GhostSpawn);for(const n of e)this.entities.push({type:u.Ghost,x:n.x,y:n.y});const i=this.grid.findTiles(r.Pellet),s=this.grid.findTiles(r.PowerPellet);this.remainingPellets=i.length+s.length}getEntities(){return this.entities}getScore(){return this.score}getRemainingPellets(){return this.remainingPellets}isPelletEaten(t,e){return this.eatenPellets.has(`${t},${e}`)}consumePellet(t,e){if(this.isPelletEaten(t,e))return;const i=this.grid.getTile(t,e);(i===r.Pellet||i===r.PowerPellet)&&(this.eatenPellets.add(`${t},${e}`),this.remainingPellets--,this.score+=i===r.Pellet?y:E)}movePacman(t,e){const i=this.entities.find(s=>s.type===u.Pacman);i&&(i.x!==t||i.y!==e)&&this.grid.isWalkable(t,e)&&!this.grid.isOutOfBounds(t,e)&&(i.x=t,i.y=e,this.consumePellet(t,e))}updatePacman(t){const e=this.entities.find(i=>i.type===u.Pacman);e&&this.movePacman(e.x+t.dx,e.y+t.dy)}}class f{static instance=null;currentDirection={dx:0,dy:0};handleKeyDownBound;constructor(){this.handleKeyDownBound=this.handleKeyDown.bind(this),typeof window<"u"&&window.addEventListener("keydown",this.handleKeyDownBound)}static getInstance(){return f.instance||(f.instance=new f),f.instance}handleKeyDown(t){switch(t.key){case"ArrowUp":case"w":case"W":this.currentDirection={dx:0,dy:-1};break;case"ArrowDown":case"s":case"S":this.currentDirection={dx:0,dy:1};break;case"ArrowLeft":case"a":case"A":this.currentDirection={dx:-1,dy:0};break;case"ArrowRight":case"d":case"D":this.currentDirection={dx:1,dy:0};break}}getDirection(){return this.currentDirection}dispose(){typeof window<"u"&&window.removeEventListener("keydown",this.handleKeyDownBound),f.instance=null}}function b(o){const t=m.fromString(x),e=new S(t),i=f.getInstance(),s=document.createElement("canvas");s.width=t.getWidth()*c,s.height=t.getHeight()*c,s.classList.add("border-2","border-gray-600"),o.appendChild(s);const n=s.getContext("2d");if(n){const l=new L(n);let a=0;const h=200,d=P=>{P-a>h&&(e.updatePacman(i.getDirection()),a=P),l.render(t,e),requestAnimationFrame(d)};requestAnimationFrame(d)}}if(typeof document<"u"){const o=document.getElementById("game-container");o&&b(o)}
